%% u,v  ,  x,y,z 

observations=[
221.59999121390774, 263.2688212463155  ,  0.182149702980207, -1.2087767369594893, 0.18 ;
219.97957254348313, 239.39632234105989  ,  0.2541056948966161, -1.200704559152434, 0.18 ;
218.51316273943408, 215.76691245765153  ,  0.34544731328034356, -1.1929374104104307, 0.18 ;
230.0928921418361, 196.36507307318806  ,  0.42148686625739407, -1.2386675855948892, 0.17999999999999997 ;
189.77480754742925, 84.12873529280958  ,  0.784631547347704, -1.0850439178850624, 0.6149999999999999 ;
232.78976898670885, 177.19343786269323  ,  0.5314631594530421, -1.222178039717734, 0.17999999999999997 ;
225.18176352808626, 162.14857621403456  ,  0.6773423724525369, -1.187164221476766, 0.17999999999999997 ;
162.4148359833869, 76.06623610965786  ,  1.068453409376924, -1.027387266561521, 0.6149999999999999 ;
147.4937064111083, 73.16885858262292  ,  1.2224018117365163, -0.9770419104665689, 0.615 ;
132.3437137905597, 71.34241066927012  ,  1.317027100342045, -0.9531238191527316, 0.6149999999999999 ;
117.54353839450359, 70.8645761579084  ,  1.3859293808189312, -0.9186738241985518, 0.615 ;
89.54021569373413, 70.79705602511075  ,  1.4693501656512835, -0.8295996840106743, 0.615 ;
70.27551050136853, 70.2698962421397  ,  1.5405699472847139, -0.7316915531920418, 0.615 ;
48.80044283142303, 70.05316391192194  ,  1.6202907103498112, -0.6368839624186682, 0.6149999999999999 ;
14.963565732003127, 68.72676130909463  ,  1.644977760958416, -0.45841381318673813, 0.615 ;
40.889773040847885, 126.93130234987818  ,  1.7354925771708556, -0.4404560992163917, 0.18 ;
27.362588156328954, 124.56857008264792  ,  1.7291050553626548, -0.3117218772094005, 0.18 ;
17.091537411203117, 121.71767669753264  ,  1.7205095380314808, -0.1788007210321334, 0.18 ;
81.0446514463436, 32.2973565264595  ,  3.4986329304262735, 1.2758453723600547, 0.615 ;
77.15778361961523, 54.97498748543389  ,  3.517290784634112, 1.426018221025714, 0.36 ;
93.16627693401414, 32.446505815995195  ,  3.46006960943823, 1.113547446990151, 0.6149999999999999 ;
136.59794432963022, 58.50061656351384  ,  3.3194636997288476, 0.6959699537793083, 0.36000000000000015 ;
184.58924470049644, 35.558849143940236  ,  3.16618703207127, 0.07165216380007897, 0.615 ;
175.53326004958512, 62.375613806012566  ,  3.1896695277841935, 0.22114655297603605, 0.36 ;
203.56054021490914, 36.975109046568484  ,  3.0899896403993083, -0.17199874092311482, 0.6149999999999999 ;
218.07838430622058, 67.59052775725618  ,  3.02222234775509, -0.2822369011108672, 0.3599999999999998 ;
270.6932641980481, 41.47950853628041  ,  2.7880556385758077, -0.7913069292321029, 0.615 ;
286.20783695333864, 42.923691871413226  ,  2.722210606962898, -0.9517698646211937, 0.6150000000000001 ;
298.1342446259218, 43.7035779594242  ,  2.6606859909649963, -1.0808135585252423, 0.6150000000000001 ;
280.0380515910185, 75.3175081889882  ,  2.7075873627124167, -0.9369377046504164, 0.36000000000000004 ;
320.90478268281487, 45.525875937382736  ,  2.578716050195673, -1.2676122515564485, 0.6150000000000002 ;
325.0968320271494, 81.11954178264733  ,  2.5584068381993634, -1.2886170002111146, 0.36 ;
323.66181589372195, 120.92235535350761  ,  1.381269230922053, -2.322656471460751, 0.36 ;
300.0523251142266, 117.89916974000828  ,  1.4799440689283576, -2.1227179135598306, 0.35999999999999993 ;
304.6436605790217, 72.50325941399421  ,  1.4926469503118216, -2.115437102702666, 0.615 ;
278.15305229947523, 115.18095176696333  ,  1.5235825830410905, -1.9673054496786084, 0.36 ;
274.95552346925956, 70.25453995000049  ,  1.5562967181842313, -1.9528429091206965, 0.6150000000000002 ;
251.32836720252098, 111.62169019053184  ,  1.5797436910108196, -1.803342944353914, 0.36000000000000015 ;
247.14820929122777, 67.97039885578546  ,  1.588229244046046, -1.7808651773021111, 0.6150000000000001 ;
226.33180209548678, 107.52187456355374  ,  1.5995621095008083, -1.6299626718206437, 0.36000000000000004 ;
202.2104577874766, 104.80048715092151  ,  1.602374800401126, -1.4478515643924386, 0.36 ;
194.46094346089174, 63.44384377317086  ,  1.653516928776126, -1.4792817570336285, 0.6150000000000001 ;
179.5130976507887, 101.15325952938949  ,  1.670638322232406, -1.3289259859900293, 0.36000000000000004 ;
158.76761733268015, 98.71905280865752  ,  1.7022101825352074, -1.1569917663539142, 0.36 ;
148.56297431388023, 59.89418702914421  ,  1.7277797812537872, -1.138059212886265, 0.615 ;
137.87706039537642, 95.50710198283427  ,  1.7439582462886472, -0.987599061121368, 0.36 ;
119.1416577646934, 92.9377203389247  ,  1.8144509015890942, -0.8286754655761135, 0.35999999999999993 ;
111.67963579634682, 56.857835594838804  ,  1.822819629702762, -0.8421001129058352, 0.615 ;
104.13788605042896, 90.6614751897439  ,  1.840103692628865, -0.6917629545957005, 0.36 ;
83.56772863011501, 87.46174852853459  ,  1.8929355663543124, -0.5302362786032515, 0.36000000000000004 ;
65.90167558747643, 85.42453380688319  ,  1.9485273087429915, -0.3506559126951484, 0.35999999999999993 ;
55.31016157784238, 83.78840411613656  ,  1.9792209603688935, -0.23562989481020524, 0.35999999999999993 ;
47.557593015804436, 52.38166679611379  ,  1.9991434117660911, -0.26503364028789533, 0.615
];

%%

pixel_coordinates = observations( 1: 8, 1:2);
pixel_coordinates = observations( 9:15, 1:2);
pixel_coordinates = observations(16:22, 1:2);

pixel_coordinates = observations(:,1:2);


%%
pixel_coordinates(:,2) = 190-pixel_coordinates(:,2);

%%
handle_f_2d = figure;
axis equal;
hold on
plot(pixel_coordinates(:,1),pixel_coordinates(:,2),'b');
plot(pixel_coordinates(:,1),pixel_coordinates(:,2),'bx');
axis ([0 352 0 240])
%  axis ([100 325 0 150])
axis equal

for i_ = 1:size(pixel_coordinates,1) 
    text(pixel_coordinates(i_,1),pixel_coordinates(i_,2),strcat('\color{magenta} ',num2str(i_)))
end

%%

world_coordinates = observations( 1: 8, 3:5);
world_coordinates = observations( 9:15, 3:5);
world_coordinates = observations(16:22, 3:5);

world_coordinates = observations(:,3:5);

handle_f_3d = figure;
axis equal;
plot3( world_coordinates(:,1) , world_coordinates(:,2) , world_coordinates(:,3) , 'bx');
hold on;
plot3( world_coordinates(:,1) , world_coordinates(:,2) , world_coordinates(:,3) );
axis equal;
%axis ([0 2.2 0 2.7 0 1.0])
axis equal;
xlabel('X');  ylabel('Y');  zlabel('Z');  grid on;

%%

cameraParams_Intrinsics = [
    519.90320*(352/640)         0    320*(352/640);
         0    518.95*(288/240)    120*(288/240);
         0         0    1 ];
     
[Re,Te,Xce,best_solutione]=efficient_pnp( world_coordinates, pixel_coordinates, cameraParams_Intrinsics );  
R = Re; T = Te; Xc = Xce; best_solution = best_solutione;
draw_axes(R, T, '\color{magenta} eff pnp', 1);

     
     
     
     